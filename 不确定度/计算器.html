<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <title>不确定度计算器</title>
    <style>
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        display: flex;
        justify-content: flex-start; /* 左对齐 */
        min-height: 100vh;
        margin: 0;
        padding: 20px;
        background-color: #f9f9f9; /* 背景色 */
        overflow: hidden;
      }

      .back-home {
        position: absolute;
        top: 20px; /* 距离顶部的距离 */
        left: 40px; /* 距离左侧的距离 */
        cursor: pointer;
        font-size: 48px; /* 图标大小 */
        color: #007bff; /* 图标颜色 */
        z-index: 10; /* 确保在最上层 */
      }

      .container {
        display: flex;
        width: calc(100% - 40px); /* 减去 back-home 的宽度 */
        max-width: 1200px; /* 控制整体宽度 */
        margin-top: 80px; /* 确保组件下面留出足够空间 */
      }

      .left-panel,
      .right-panel {
        flex: 1; /* 平分空间 */
        padding: 20px;
        box-sizing: border-box;
      }

      .left-panel {
        border-right: 1px solid #ccc; /* 左侧面板右边界 */
        overflow-y: auto; /* 允许垂直滚动 */
        max-height: calc(100vh - 130px); /* 减去上方空间 */
      }

      h1 {
        margin-bottom: 20px;
        text-align: center;
      }

      table {
        margin: 20px 0;
        border-collapse: collapse;
        width: 100%; /* 表格宽度 */
      }

      th,
      td {
        border: 1px solid #ccc;
        padding: 8px;
        text-align: center;
        cursor: text;
      }

      select,
      button {
        margin: 10px 5px; /* 调整左右间距 */
        width: 100%; /* 选择框和按钮宽度 */
      }

      .rowCount-container {
        display: flex; /* 使用 Flexbox 布局 */
        align-items: center; /* 垂直居中对齐 */
        margin-bottom: 20px; /* 与下方内容留出间距 */
      }

      .rowCount-container label {
        margin-right: 10px; /* 标签与输入框之间的间距 */
      }
    </style>
  </head>
  <body>
    <div class="back-home" onclick="goHome()">
      <i class="fas fa-home"></i>
      <!-- Font Awesome 图标 -->
    </div>

    <div class="container">
      <div class="left-panel">
        <label for="dataInput">输入数据：</label><br />
        <table id="dataInput">
          <thead>
            <tr>
              <th>数据值 1</th>
              <th>数据值 2</th>
              <th>数据值 3</th>
              <th>数据值 4</th>
            </tr>
          </thead>
          <tbody>
            <!-- 默认显示 20 行 4 列 -->
            <script>
              for (let i = 0; i < 20; i++) {
                document.write("<tr>");
                for (let j = 0; j < 4; j++) {
                  document.write(
                    '<td contenteditable="true" onkeydown="moveCursor(event, this)"></td>'
                  );
                }
                document.write("</tr>");
              }
            </script>
          </tbody>
        </table>
        <div class="rowCount-container">
          <!-- <label for="rowCount">输入要增加的行数:</label> -->
          <input type="number" id="rowCount" min="1" placeholder="行数" />
          <button onclick="addRow()">增加行</button>
        </div>
      </div>

      <div class="right-panel">
        <h1>不确定度计算器</h1>
        <label for="measurements">选择测量次数:</label>
        <select id="measurements">
          <option value="5">5</option>
          <option value="10">10</option>
          <option value="20">20</option>
          <option value="其他">其他</option>
        </select>
        <input
          type="number"
          id="customMeasurements"
          placeholder="输入测量次数"
          disabled
        /><br />

        <label for="confidence">选择置信概率:</label>
        <select id="confidence">
          <option value="0.95">95%</option>
          <option value="0.99">99%</option></select
        ><br /><br />

        <button onclick="calculateUncertainty()">计算不确定度</button>
        <p id="result"></p>
      </div>
    </div>

    <script>
      function goHome() {
        window.location.href = "../menu.html"; // 修改为您的首页链接
      }

      function addRow() {
        const rowCount = parseInt(document.getElementById("rowCount").value);
        const tableBody = document
          .getElementById("dataInput")
          .getElementsByTagName("tbody")[0];

        if (isNaN(rowCount) || rowCount < 1) {
          alert("请输入有效的行数。");
          return;
        }

        for (let i = 0; i < rowCount; i++) {
          const newRow = tableBody.insertRow();
          for (let j = 0; j < 4; j++) {
            const newCell = newRow.insertCell(j);
            newCell.contentEditable = "true"; // 允许编辑的单元格
            newCell.onkeydown = function (event) {
              moveCursor(event, newCell);
            }; // 绑定键盘事件
          }
        }
        document.getElementById("rowCount").value = ""; // 清空输入框
      }

      function moveCursor(event, cell) {
        const row = cell.parentNode;
        const tableBody = document
          .getElementById("dataInput")
          .getElementsByTagName("tbody")[0];
        const cells = row.querySelectorAll("td");
        const cellIndex = Array.from(cells).indexOf(cell);
        const currentRowIndex = Array.from(tableBody.rows).indexOf(row);

        if (event.key === "ArrowRight") {
          if (cellIndex < cells.length - 1) {
            cells[cellIndex + 1].focus();
          } else if (currentRowIndex < tableBody.rows.length - 1) {
            tableBody.rows[currentRowIndex + 1].cells[0].focus();
          }
          event.preventDefault();
        } else if (event.key === "ArrowLeft") {
          if (cellIndex > 0) {
            cells[cellIndex - 1].focus();
          } else if (currentRowIndex > 0) {
            tableBody.rows[currentRowIndex - 1].cells[cells.length - 1].focus();
          }
          event.preventDefault();
        } else if (event.key === "ArrowDown") {
          if (currentRowIndex < tableBody.rows.length - 1) {
            tableBody.rows[currentRowIndex + 1].cells[cellIndex].focus();
          }
          event.preventDefault();
        } else if (event.key === "ArrowUp") {
          if (currentRowIndex > 0) {
            tableBody.rows[currentRowIndex - 1].cells[cellIndex].focus();
          }
          event.preventDefault();
        }
      }

      function calculateUncertainty() {
        const rows = document.querySelectorAll("#dataInput tbody tr");
        const data = [];
        rows.forEach((row) => {
          const rowData = [];
          row.querySelectorAll("td").forEach((cell) => {
            const cellValue = cell.innerText.trim();
            if (!isNaN(cellValue) && cellValue !== "") {
              rowData.push(Number(cellValue));
            }
          });
          if (rowData.length > 0) {
            data.push(...rowData);
          }
        });

        const measurements = document.getElementById("measurements").value;
        const confidence = document.getElementById("confidence").value;

        let n =
          measurements === "其他"
            ? parseFloat(document.getElementById("customMeasurements").value)
            : measurements;
        let uncertainty = 0;

        const standardUncertainty = calculateStandardUncertainty(data);
        const k = getKValue(confidence);
        uncertainty = k * standardUncertainty;

        document.getElementById(
          "result"
        ).innerText = `不确定度: ${uncertainty.toFixed(4)}`;
      }

      function calculateStandardUncertainty(data) {
        return 0.5; // 示例值
      }

      function getKValue(confidence) {
        const kValues = {
          0.95: 2,
          0.99: 3,
        };
        return kValues[confidence];
      }
    </script>

    <!-- Font Awesome Icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
    />
  </body>
</html>
